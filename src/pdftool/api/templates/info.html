{% extends "base.html" %}

{% block title %}PDFä¿¡æ¯ - PDFTool{% endblock %}

{% block header_icon %}â„¹ï¸{% endblock %}
{% block header_title %}PDFä¿¡æ¯{% endblock %}
{% block header_description %}æŸ¥çœ‹PDFæ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯å’Œå±æ€§{% endblock %}

{% set show_back_button = true %}

{% block content %}
<div class="upload-area" id="infoDropZone">
    <h3>é€‰æ‹©è¦æŸ¥çœ‹ä¿¡æ¯çš„PDFæ–‡ä»¶</h3>
    <input type="file" id="infoFile" accept=".pdf">
    <br>
    <button onclick="getPDFInfo()">è·å–æ–‡ä»¶ä¿¡æ¯</button>
</div>
<div class="progress-bar" id="infoProgress">
    <div class="progress-fill"></div>
</div>
<div id="infoResult"></div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', path='/js/upload.js') }}"></script>
<script>
    // è®¾ç½®æ‹–æ”¾åŒºåŸŸ
    setupDropZone('infoDropZone', 'infoFile');

    async function getPDFInfo() {
        const file = document.getElementById('infoFile').files[0];
        if (!file) {
            showResult('infoResult', 'è¯·é€‰æ‹©PDFæ–‡ä»¶', false);
            return;
        }

        const formData = new FormData();
        formData.append('file', file);

        showProgress('infoProgress');

        try {
            const response = await fetch('/api/v1/pdf/info', {
                method: 'POST',
                body: formData
            });
            
            hideProgress('infoProgress');
            
            if (response.ok) {
                const info = await response.json();
                const sizeInMB = (info.file_size / 1024 / 1024).toFixed(2);
                showResult('infoResult', `
                    <strong>ğŸ“‹ PDFæ–‡ä»¶ä¿¡æ¯:</strong><br><br>
                    ğŸ“„ <strong>é¡µæ•°:</strong> ${info.pages}<br>
                    ğŸ“ <strong>æ ‡é¢˜:</strong> ${info.title || 'æ— '}<br>
                    ğŸ‘¤ <strong>ä½œè€…:</strong> ${info.author || 'æ— '}<br>
                    ğŸ“… <strong>åˆ›å»ºæ—¶é—´:</strong> ${info.creation_date || 'æ— '}<br>
                    ğŸ’¾ <strong>æ–‡ä»¶å¤§å°:</strong> ${sizeInMB} MB
                `, true);
            } else {
                const error = await response.json();
                showResult('infoResult', `âŒ é”™è¯¯: ${error.message}`, false);
            }
        } catch (error) {
            hideProgress('infoProgress');
            showResult('infoResult', `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, false);
        }
    }
</script>
{% endblock %}